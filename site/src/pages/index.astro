---
import Link from '@/components/Link.astro'
import PageHead from '@/components/PageHead.astro'
import { Icon } from 'astro-icon/components'
import Layout from '@/layouts/Layout.astro'
import { getRecentPosts } from '@/lib/data-utils'
import { cn } from '@/lib/utils'

const allPosts = await getRecentPosts(20)
const recentPosts = allPosts.slice(0, 10)
const popularPosts = allPosts.slice(0, 5) // Mock popular posts for now

// Mock data for experiments
const experiments = [
  { title: 'Color perception in CIELAB space', href: '#', date: 'Dec 2024' },
  { title: 'WebGL particle systems', href: '#', date: 'Nov 2024' },
  { title: 'Information density experiments', href: '#', date: 'Oct 2024' },
]
---

<Layout class="max-w-7xl">
  <PageHead slot="head" title="Ryan Barnett" />
  
  <!-- Header -->
  <header class="mb-12 pt-4">
    <h1 class="text-3xl font-normal mb-4">Ryan Barnett</h1>
    <p class="text-base text-foreground/80 max-w-3xl">
      Senior engineer turned engineering leader. Previously at The Washington Post, 
      where I helped build systems that served millions of readers daily. 
      I write about software architecture, web performance, and the intersection 
      of technology and human systems. Currently exploring tools for thought and information architecture.
    </p>
    <nav class="mt-6 flex gap-6 text-sm">
      <Link href="/about" class="hover:underline">About</Link>
      <Link href="/blog" class="hover:underline">Blog</Link>
      <Link href="https://github.com/rmbrntt" external class="hover:underline">GitHub↗</Link>
      <Link href="/rss.xml" class="hover:underline">RSS</Link>
    </nav>
  </header>

  <!-- Main Content Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
    
    <!-- Primary Column - Recent Writing -->
    <div class="lg:col-span-2 space-y-8">
      <section>
        <h2 class="text-lg font-semibold mb-4 pb-2 border-b">Recent Writing</h2>
        <ul class="space-y-1">
          {recentPosts.map((post, index) => (
            <li class="flex items-baseline gap-4 py-2 group">
              <time datetime={post.data.date.toISOString()} class="text-sm text-muted-foreground whitespace-nowrap">
                {new Date(post.data.date).toLocaleDateString('en-US', { 
                  month: 'short', 
                  day: 'numeric',
                  year: 'numeric'
                })}
              </time>
              <Link 
                href={`/blog/${post.id}`} 
                class="hover:underline flex-1"
              >
                {post.data.title}
              </Link>
            </li>
          ))}
        </ul>
        <div class="mt-4 pt-4 border-t">
          <Link href="/blog" class="text-sm text-muted-foreground hover:text-foreground hover:underline">
            View all posts →
          </Link>
        </div>
      </section>

      <!-- Experiments/Projects -->
      <section>
        <h2 class="text-lg font-semibold mb-4 pb-2 border-b">Experiments & Ideas</h2>
        <ul class="space-y-1">
          {experiments.map(exp => (
            <li class="flex items-baseline gap-4 py-2">
              <span class="text-sm text-muted-foreground whitespace-nowrap">
                {exp.date}
              </span>
              <Link href={exp.href} class="hover:underline flex-1">
                {exp.title}
              </Link>
            </li>
          ))}
        </ul>
      </section>
    </div>

    <!-- Sidebar -->
    <aside class="space-y-8">
      <!-- Popular -->
      <section>
        <h3 class="text-lg font-semibold mb-4 pb-2 border-b">Popular</h3>
        <ul class="space-y-2">
          {popularPosts.map(post => (
            <li>
              <Link href={`/blog/${post.id}`} class="text-sm hover:underline">
                {post.data.title}
              </Link>
            </li>
          ))}
        </ul>
      </section>

      <!-- Now -->
      <section>
        <h3 class="text-lg font-semibold mb-4 pb-2 border-b">Now</h3>
        <div class="text-sm text-foreground/80 space-y-2">
          <p>Building in public, exploring the edges of web technology.</p>
          <p>Focus areas:</p>
          <ul class="ml-4 space-y-1">
            <li>• Tools for thought</li>
            <li>• Information architecture</li>
            <li>• Web performance</li>
            <li>• Engineering leadership</li>
          </ul>
          <p class="text-xs text-muted-foreground pt-2">
            Last updated: {new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
          </p>
        </div>
      </section>

      <!-- External Links -->
      <section>
        <h3 class="text-lg font-semibold mb-4 pb-2 border-b">Elsewhere</h3>
        <ul class="space-y-2 text-sm">
          <li>
            <Link href="https://github.com/rmbrntt" external class="hover:underline">
              GitHub
            </Link>
          </li>
          <li>
            <Link href="https://linkedin.com/in/rmbrntt" external class="hover:underline">
              LinkedIn
            </Link>
          </li>
          <li>
            <Link href="https://twitter.com/rmbrntt" external class="hover:underline">
              Twitter
            </Link>
          </li>
        </ul>
      </section>

      <!-- Reading -->
      <section>
        <h3 class="text-lg font-semibold mb-4 pb-2 border-b">Reading & Inspiration</h3>
        <ul class="space-y-2 text-sm">
          <li>
            <Link href="#" external class="hover:underline">
              Tools for Thought
            </Link>
            <span class="text-muted-foreground"> — Howard Rheingold</span>
          </li>
          <li>
            <Link href="#" external class="hover:underline">
              The Garden and the Stream
            </Link>
            <span class="text-muted-foreground"> — Mike Caulfield</span>
          </li>
          <li>
            <Link href="#" external class="hover:underline">
              How to Make Sense of Any Mess
            </Link>
            <span class="text-muted-foreground"> — Abby Covert</span>
          </li>
        </ul>
      </section>
    </aside>
  </div>

  <!-- Footer -->
  <footer class="mt-16 pt-8 border-t text-sm text-muted-foreground">
    <p>
      This site is a continuous work in progress. 
      <Link href="/colophon" class="hover:underline">Colophon</Link> • 
      <Link href="/changelog" class="hover:underline">Changelog</Link>
    </p>
  </footer>
</Layout>