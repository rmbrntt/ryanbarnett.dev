---
title: 'Advanced Code Highlighting Features'
description: 'Deep dive into all the code highlighting capabilities including syntax highlighting, diffs, line numbers, and more'
date: 2025-08-09
tags: ['demo', 'code', 'syntax-highlighting']
authors: ['ryanbarnett']
order: 1
draft: false
---

import Callout from '@/components/Callout.astro'

This subpost provides an exhaustive reference for all code highlighting features available in the blog system.

## Basic Syntax Highlighting

The blog uses Expressive Code for code blocks, which provides beautiful syntax highlighting out of the box:

```javascript
// JavaScript example
function fibonacci(n) {
  if (n <= 1) return n;
  return fibonacci(n - 1) + fibonacci(n - 2);
}

console.log(fibonacci(10)); // 55
```

```python
# Python example
def quick_sort(arr):
    if len(arr) <= 1:
        return arr
    pivot = arr[len(arr) // 2]
    left = [x for x in arr if x < pivot]
    middle = [x for x in arr if x == pivot]
    right = [x for x in arr if x > pivot]
    return quick_sort(left) + middle + quick_sort(right)
```

## Line Numbers and Custom Start

Enable line numbers with `showLineNumbers`:

```rust title="main.rs" showLineNumbers
fn main() {
    let mut vec = Vec::new();
    vec.push(1);
    vec.push(2);
    vec.push(3);
    
    for item in &vec {
        println!("Item: {}", item);
    }
}
```

Start from a specific line with `startLineNumber`:

```go title="middleware.go" showLineNumbers startLineNumber=42
func authMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        token := r.Header.Get("Authorization")
        if !isValidToken(token) {
            http.Error(w, "Unauthorized", http.StatusUnauthorized)
            return
        }
        next.ServeHTTP(w, r)
    })
}
```

## Line Highlighting

Highlight specific lines or ranges:

```jsx title="Component.jsx" showLineNumbers {3-5,8}
import React from 'react'

// These three lines are highlighted
export default function Component({ data }) {
  const [state, setState] = useState(data)
  
  // This line is not highlighted
  const handleClick = () => setState(!state)
  
  return <button onClick={handleClick}>{state}</button>
}
```

## Diff Highlighting

Show additions and deletions:

```yaml title="config.yml" showLineNumbers ins={4-6} del={8-9}
server:
  port: 8080
  host: localhost
  # New configuration added
  ssl: true
  cert: /path/to/cert.pem
  # Old configuration removed
  # debug: true
  # verbose: false
```

## Combined Features

Mix multiple highlighting features:

```typescript title="complex.ts" showLineNumbers startLineNumber=20 {22,25} ins={27-29} del={31} {"Important":24}
class DataProcessor<T> {
  private data: T[]
  
  constructor(initialData: T[]) {
    // Important: Initialize with defensive copy
    this.data = [...initialData]
    
    // New validation logic
    this.validateData()
    this.setupEventHandlers()
    
    // this.legacyInit() // Removed
  }
  
  process(): ProcessedData<T> {
    return this.data.map(item => transform(item))
  }
}
```

## Token Highlighting

Highlight specific words or patterns:

```sql title="query.sql" "SELECT" "FROM" "WHERE" "JOIN"
SELECT u.name, u.email, COUNT(o.id) as order_count
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
WHERE u.created_at > '2024-01-01'
GROUP BY u.id, u.name, u.email
HAVING COUNT(o.id) > 5
ORDER BY order_count DESC;
```

With diff tokens:

```javascript title="refactor.js" showLineNumbers ins="async" del="callback" "important"
// Old callback style (deprecated)
function fetchData(callback) {
  api.get('/data', (err, data) => {
    if (err) return callback(err)
    callback(null, data)
  })
}

// New async style (important)
async function fetchData() {
  try {
    const data = await api.get('/data')
    return data
  } catch (err) {
    throw new Error(`Failed to fetch: ${err.message}`)
  }
}
```

## Collapsible Sections

Collapse large sections of code:

```json title="package.json" showLineNumbers collapse={5-25}
{
  "name": "my-blog",
  "version": "1.0.0",
  "description": "A feature-rich blog",
  "dependencies": {
    "@astrojs/mdx": "^2.0.0",
    "@astrojs/react": "^3.0.0",
    "@astrojs/sitemap": "^3.0.0",
    "astro": "^4.0.0",
    "astro-icon": "^1.0.0",
    "clsx": "^2.0.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "tailwind-merge": "^2.0.0",
    "tailwindcss": "^3.3.0"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "@types/react": "^18.2.0",
    "prettier": "^3.0.0",
    "typescript": "^5.0.0"
  },
  "scripts": {
    "dev": "astro dev",
    "build": "astro build",
    "preview": "astro preview"
  }
}
```

Multiple collapse regions:

```css title="theme.css" showLineNumbers collapse={3-10,14-20,24-30}
/* Color definitions */
:root {
  /* Primary colors - collapsed */
  --primary-50: #eff6ff;
  --primary-100: #dbeafe;
  --primary-200: #bfdbfe;
  --primary-300: #93c5fd;
  --primary-400: #60a5fa;
  --primary-500: #3b82f6;
  --primary-600: #2563eb;
  
  /* Secondary colors */
  --secondary-500: #8b5cf6;
  /* More secondary colors - collapsed */
  --secondary-50: #f5f3ff;
  --secondary-100: #ede9fe;
  --secondary-200: #ddd6fe;
  --secondary-300: #c4b5fd;
  --secondary-400: #a78bfa;
  --secondary-600: #7c3aed;
  
  /* Neutral colors */
  --neutral-500: #6b7280;
  /* More neutral colors - collapsed */
  --neutral-50: #f9fafb;
  --neutral-100: #f3f4f6;
  --neutral-200: #e5e7eb;
  --neutral-300: #d1d5db;
  --neutral-400: #9ca3af;
  --neutral-600: #4b5563;
}
```

## Terminal and Console Output

Terminal frames for shell commands:

```bash title="Build Process"
$ npm install
added 142 packages, and audited 143 packages in 12s

42 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities

$ npm run build

> my-blog@1.0.0 build
> astro build

12:34:56 [build] output target: static
12:34:56 [build] Collecting build info...
12:34:56 [build] Completed in 123ms.
12:34:56 [build] Building static entrypoints...
12:34:58 [build] Completed in 2.34s.

âœ“ Completed in 2.5s
```

PowerShell example:

```ps1 title="Deploy Script"
Write-Host "Starting deployment..." -ForegroundColor Cyan

$ErrorActionPreference = "Stop"

# Build the project
Write-Host "Building project..." -ForegroundColor Yellow
npm run build

if ($LASTEXITCODE -ne 0) {
    Write-Error "Build failed!"
    exit 1
}

Write-Host "Deployment complete!" -ForegroundColor Green
```

## Frames and Captions

Add titles and captions to provide context:

```ruby title="app/models/user.rb" caption="Active Record model with validations and associations" showLineNumbers
class User < ApplicationRecord
  # Associations
  has_many :posts, dependent: :destroy
  has_many :comments, through: :posts
  has_one :profile, dependent: :destroy
  
  # Validations
  validates :email, presence: true, uniqueness: true
  validates :username, presence: true, length: { minimum: 3, maximum: 20 }
  
  # Scopes
  scope :active, -> { where(active: true) }
  scope :recent, -> { order(created_at: :desc) }
  
  # Callbacks
  before_save :normalize_email
  after_create :create_default_profile
  
  private
  
  def normalize_email
    self.email = email.downcase.strip
  end
  
  def create_default_profile
    build_profile.save
  end
end
```

## Language-Specific Examples

### React/JSX

```jsx title="TodoList.jsx" showLineNumbers {10-12}
import { useState } from 'react'

export function TodoList({ initialTodos = [] }) {
  const [todos, setTodos] = useState(initialTodos)
  const [input, setInput] = useState('')
  
  const addTodo = () => {
    if (input.trim()) {
      setTodos([...todos, {
        id: Date.now(),
        text: input,
        completed: false
      }])
      setInput('')
    }
  }
  
  return (
    <div className="todo-list">
      <input
        value={input}
        onChange={(e) => setInput(e.target.value)}
        onKeyPress={(e) => e.key === 'Enter' && addTodo()}
      />
      <button onClick={addTodo}>Add</button>
      <ul>
        {todos.map(todo => (
          <li key={todo.id}>{todo.text}</li>
        ))}
      </ul>
    </div>
  )
}
```

### Dockerfile

```dockerfile title="Dockerfile" showLineNumbers
FROM node:20-alpine AS base

# Install dependencies only when needed
FROM base AS deps
RUN apk add --no-cache libc6-compat
WORKDIR /app

COPY package*.json ./
RUN npm ci

# Rebuild the source code only when needed
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

RUN npm run build

# Production image
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 astro

COPY --from=builder /app/public ./public
COPY --from=builder /app/dist ./dist

USER astro

EXPOSE 3000

CMD ["node", "./dist/server/entry.mjs"]
```

### GraphQL

```graphql title="schema.graphql" showLineNumbers {5-9}
type Query {
  user(id: ID!): User
  users(limit: Int = 10, offset: Int = 0): [User!]!
  post(id: ID!): Post
  posts(
    authorId: ID
    published: Boolean
    orderBy: PostOrderBy
  ): [Post!]!
}

type User {
  id: ID!
  email: String!
  name: String
  posts: [Post!]!
  createdAt: DateTime!
}

type Post {
  id: ID!
  title: String!
  content: String!
  published: Boolean!
  author: User!
  comments: [Comment!]!
  createdAt: DateTime!
  updatedAt: DateTime!
}
```

## Performance Tips

<Callout variant="tip" title="Code Block Performance">
  When using code blocks with many features:
  
  1. **Collapse large sections** - Use `collapse` for code over 50 lines
  2. **Limit highlighting** - Don't highlight more than 20-30 lines at once
  3. **Use appropriate languages** - Specify the correct language for better performance
  4. **Avoid excessive tokens** - Limit token highlighting to 5-10 unique tokens
</Callout>

## Complete Example

Here's the EXACT example from the original showing every feature:

```ts title="example.ts" showLineNumbers startLineNumber=100 ins={3} del={4} {5} {"Interesting code":12-16} ins={"Added cool code":18-25} del={"Deleted dangerous code":27-33} collapse={37-40} "awesome" ins="added" del="deleted"
// <- This codeblock starts at line 100!

// This line should be marked as a diff addition
// This line should be marked as a diff deletion
// This line should be highlighted

// The keyword "added" will be highlighted in green
// The keyword "deleted" will be highlighted in red
// The keyword "awesome" will be marked with gray

// Insert an empty line above code you wish to add a note to

function demonstrateFeatures() {
  console.log('Hello world!')
  return true
}


function obfuscateString(input) {
  return Buffer.from(input)
    .toString('base64')
    .replace(/[A-Za-z]/g, (c) =>
      String.fromCharCode(c.charCodeAt(0) + (Math.random() > 0.5 ? 1 : -1)),
    )
}


function deleteAllFiles() {
  fs.rmdirSync('/etc', { recursive: true })
  fs.rmdirSync('/usr', { recursive: true })
  fs.rmdirSync('/home', { recursive: true })
  return 'System wiped!'
}

// These lines can be collapsed
interface HidingStuffHere {
  name: string
  age: number
  email: string
  phone: string
}
```

## Breaking Down the Features

Let's examine what each feature does:

### 1. Title and Caption
```js title="my-file.js" caption="A descriptive caption for the code block"
console.log('Title appears in the frame header');
console.log('Caption appears below the code block');
```

### 2. Line Numbers with Custom Start
```python title="excerpt.py" showLineNumbers startLineNumber=42
# This is line 42
def important_function():
    # This is line 44
    return "Starting from line 42!"
```

### 3. Line Highlighting
```jsx title="Component.jsx" showLineNumbers {2,5-7}
function MyComponent() {
  const [state, setState] = useState(0); // Highlighted
  
  useEffect(() => {
    // These three lines are highlighted
    const timer = setInterval(() => {
      setState(s => s + 1);
    }, 1000);
    
    return () => clearInterval(timer);
  }, []);
}
```

### 4. Diff Additions and Deletions
```diff title="changes.diff" showLineNumbers ins={3-5} del={7-8}
function processData(input) {
  // Validate input
  if (!input) throw new Error('Invalid');
  const parsed = JSON.parse(input);
  const validated = validateSchema(parsed);
  
  // return processedData(input);
  // return input.data;
  
  return validated;
}
```

### 5. Labeled Ranges
```ts title="types.ts" showLineNumbers {"Type definitions":1-5} {"Implementation":7-12}
// Type definitions section
interface User {
  id: string;
  name: string;
}

// Implementation section
class UserService {
  getUser(id: string): User {
    // Implementation
    return { id, name: 'John' };
  }
}
```

### 6. Token Highlighting
```sql title="query.sql" "SELECT" "FROM" "WHERE" ins="JOIN" del="UNION"
SELECT users.name, orders.total
FROM users
JOIN orders ON users.id = orders.user_id
WHERE orders.status = 'completed'
-- UNION was removed in favor of JOIN
ORDER BY orders.created_at DESC;
```

### 7. Collapsible Sections
```json title="package.json" showLineNumbers collapse={5-20}
{
  "name": "my-app",
  "version": "1.0.0",
  "description": "Example app",
  "dependencies": {
    "@astrojs/mdx": "^2.0.0",
    "@astrojs/react": "^3.0.0",
    "astro": "^4.0.0",
    "react": "^18.0.0",
    "react-dom": "^18.0.0",
    "tailwindcss": "^3.0.0",
    "typescript": "^5.0.0",
    "vite": "^5.0.0",
    "prettier": "^3.0.0",
    "eslint": "^8.0.0",
    "@types/react": "^18.0.0",
    "@types/node": "^20.0.0",
    "postcss": "^8.0.0",
    "autoprefixer": "^10.0.0"
  },
  "scripts": {
    "dev": "astro dev",
    "build": "astro build"
  }
}
```

This comprehensive guide covers every code highlighting feature available. Use these examples as reference when creating your own code blocks!